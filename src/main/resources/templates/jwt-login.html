<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ë¡œê·¸ì¸</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" th:href="@{/css/login.css}"/>
    <script>
        function toggleFormLogin() {
            const form = document.getElementById("formLogin");
            form.style.display = (form.style.display === "none") ? "block" : "none";
        }
    </script>
</head>
<body>

<div class="login-container">
    <h1>ë¡œê·¸ì¸</h1>

    <!-- âœ… Keycloak ë¡œê·¸ì¸ ë©”ì¸ -->
    <a class="oauth-btn" th:href="@{/oauth2/authorization/keycloak}">
        <button class="btn">Keycloak ë¡œê·¸ì¸</button>
    </a>

    <!-- ğŸ”„ ë¹„ìƒìš© í¼ ë¡œê·¸ì¸ í† ê¸€ -->
    <button class="toggle-btn" onclick="toggleFormLogin()">ğŸ‘‰ í¼ ë¡œê·¸ì¸ ì‚¬ìš© (ë¹„ìƒìš©)</button>

    <!-- â›‘ í¼ ë¡œê·¸ì¸ ì˜ì—­ -->
    <div id="formLogin">
        <form id="adminLoginForm">
            <!--        <form method="post" th:action="@{/perform_login}">-->
            <input id="username" name="username" placeholder="Username" required/>
            <input id="password" name="password" placeholder="Password" required type="password"/>
            <button class="btn" type="submit">í¼ ë¡œê·¸ì¸</button>
        </form>
    </div>
</div>
<script>
    document.getElementById("adminLoginForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        const res = await fetch("/admin/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({username, password})
        });

        if (res.ok) {
            const {accessToken, redirectUrl} = await res.json();
            // JWT í† í°ì„ localStorageë‚˜ cookie ë“±ì— ì €ì¥
            localStorage.setItem("accessToken", accessToken);
            // ë¡œê·¸ì¸ ì„±ê³µ í›„ í™ˆìœ¼ë¡œ ì´ë™
            window.location.href = redirectUrl;
            // window.location.href = "/home.html"
        } else {
            alert("ë¡œê·¸ì¸ ì‹¤íŒ¨");
        }
    });
</script>
</body>
</html>
